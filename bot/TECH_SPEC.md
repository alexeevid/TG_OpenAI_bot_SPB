TECH_SPEC.md ‚Äî –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ Telegram-–±–æ—Ç–∞ —Å RAG –∏ –ë–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π
–í–µ—Ä—Å–∏—è –¢–ó: 1.0.0
–î–∞—Ç–∞: 2025-07-31
–í–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–æ–¥—É–∫—Ç–∞: –ò–≤–∞–Ω –ê–ª–µ–∫—Å–µ–µ–≤
–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏: –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±–æ—Ç–∞

‚ö†Ô∏è –ü—Ä–æ—Ü–µ—Å—Å: –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –±–æ—Ç–∞, –ø–æ–≤–µ–¥–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –º–æ–¥—É–ª–µ–π, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Å–æ–≥–ª–∞—Å—É–µ—Ç—Å—è —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –ø—Ä–æ–¥—É–∫—Ç–∞ –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏¬ª (—Å –ø–æ–≤—ã—à–µ–Ω–∏–µ–º –≤–µ—Ä—Å–∏–∏ –¢–ó).

1. –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π:

–≤–µ–¥—ë—Ç –¥–∏–∞–ª–æ–≥–∏ (—Ç–µ–∫—Å—Ç/–≥–æ–ª–æ—Å) —Å —É—á—ë—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞;

–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π;

–≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤–µ–±-–ø–æ–∏—Å–∫ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤;

–∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å –ë–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π (–ë–ó) –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–µ;

–∏—Å–ø–æ–ª—å–∑—É–µ—Ç RAG-–ø–æ–¥—Ö–æ–¥: –ø—Ä–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –ë–ó –æ—Ç–≤–µ—Ç—ã –æ–ø–∏—Ä–∞—é—Ç—Å—è –Ω–∞ –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã; –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ë–ó ‚Äî –≤—ã—Å–æ–∫–∏–π;

–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ pgvector —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º —Ñ–æ–ª–±—ç–∫–æ–º –Ω–∞ —Ñ–∞–π–ª–æ–≤—ã–π/–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫.

2. –ì–ª–æ—Å—Å–∞—Ä–∏–π
–î–∏–∞–ª–æ–≥ ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ç–æ–∫ –æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –±–æ—Ç–æ–º. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–º–æ–¥–µ–ª—å, —Å—Ç–∏–ª—å, –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ë–ó) –∂–∏–≤—É—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–µ–∫—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞.

RAG ‚Äî Retrieval Augmented Generation: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –∏–∑ –ë–ó + –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –º–æ–¥–µ–ª—å—é —Å —É—á—ë—Ç–æ–º —ç—Ç–∏—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤.

–ë–ó ‚Äî –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π: –ø–∞–ø–∫–∞ –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–µ, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º–∞—è —Å –ª–æ–∫–∞–ª—å–Ω—ã–º/–ë–î –∏–Ω–¥–µ–∫—Å–æ–º (—á–∞–Ω–∫–∏ + —ç–º–±–µ–¥–¥–∏–Ω–≥–∏).

–î–æ–∫—É–º–µ–Ω—Ç –ë–ó ‚Äî —Ñ–∞–π–ª –≤ –ë–ó (pdf/docx/‚Ä¶); –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω (–ø–∞—Ä–æ–ª—å).

–ß–∞–Ω–∫ ‚Äî —Ñ—Ä–∞–≥–º–µ–Ω—Ç —Ç–µ–∫—Å—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ë–ó, —É—á–∞—Å—Ç–≤—É—é—â–∏–π –≤ —Ä–µ—Ç—Ä–∏–≤–µ.

pgvector ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ PostgreSQL –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤.

3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (UX)
3.1. –î–∏–∞–ª–æ–≥–∏ (/dialogs)
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ —Å–≤–æ–∏—Ö –¥–∏–∞–ª–æ–≥–æ–≤:

–Ω–∞–∑–≤–∞–Ω–∏–µ, –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –º–∞—Ä–∫–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ;

—Ä—è–¥–æ–º –∫–Ω–æ–ø–∫–∏ –û—Ç–∫—Ä—ã—Ç—å –∏ üóë –£–¥–∞–ª–∏—Ç—å;

–∫–Ω–æ–ø–∫–∞ ‚ûï –ù–æ–≤—ã–π –¥–∏–∞–ª–æ–≥.

–£–¥–∞–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ñ–∞–π–ª—ã –ë–ó –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

3.2. –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ (/model)
–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π OpenAI: gpt-4o, gpt-4.1, gpt-4o-mini, o1*, o3*, –¥—Ä.

–¢–µ–∫—É—â–∞—è –º–æ–¥–µ–ª—å –ø–æ–º–µ—á–µ–Ω–∞ ‚úÖ.

–ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–Ω–µ—Ç –ø—Ä–∞–≤/–¥–æ—Å—Ç—É–ø–∞) –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å üîí –∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∫ –≤—ã–±–æ—Ä—É.

–í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∏ –¥–∏–∞–ª–æ–≥-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π.

3.3. –°—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–æ–≤ (/mode)
–†–µ–∂–∏–º—ã: Pro, Expert, User, CEO.

–í–ª–∏—è–µ—Ç –Ω–∞ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å/—Å—Ç—Ä—É–∫—Ç—É—Ä—É/–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –æ—Ç–≤–µ—Ç–∞.

–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º –ø–æ–º–µ—á–∞–µ—Ç—Å—è ‚úÖ.

3.4. –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
–í—Ö–æ–¥—è—â–µ–µ –∞—É–¥–∏–æ ‚Üí —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è (Whisper/gpt-4o-mini-transcribe).

–í –æ—Ç–≤–µ—Ç:

—Å—Ç—Ä–æ–∫–∞ üéôÔ∏è –í—ã —Å–∫–∞–∑–∞–ª–∏: <—Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç>

–¥–∞–ª–µ–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –±–æ—Ç–∞ (—Å —É—á—ë—Ç–æ–º –ë–ó/—Å—Ç–∏–ª—è/–º–æ–¥–µ–ª–∏).

3.5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (/img <prompt>)
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π IMAGE_MODEL (gpt-image-1 –∏–ª–∏ dall-e-3).

–ü—Ä–∏ 403/–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ ‚Äî —Ñ–æ–ª–±—ç–∫ –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, dall-e-3).

–í –ø–æ–¥–ø–∏—Å–∏ –∫ –∫–∞—Ä—Ç–∏–Ω–∫–µ –≤—ã–≤–µ—Å—Ç–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π prompt, —É—à–µ–¥—à–∏–π –≤ API.

3.6. –í–µ–±-–ø–æ–∏—Å–∫ (/web <–∑–∞–ø—Ä–æ—Å>)
–†–µ–∞–ª—å–Ω—ã–π HTTP-–ø–æ–∏—Å–∫ —Å follow_redirects=true.

–û—Ç–≤–µ—Ç —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ø–æ –Ω–∞–π–¥–µ–Ω–Ω—ã–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º.

–í–Ω–∏–∑—É ‚Äî —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (URL).

–ï—Å–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –Ω–µ—Ç ‚Äî —è–≤–Ω–æ —Å–æ–æ–±—â–∏—Ç—å –æ–± —ç—Ç–æ–º.

3.7. –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (/kb)
–û—Ç–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é:

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî –∞–¥–º–∏–Ω: –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–Ø.–î–∏—Å–∫ ‚Üí –∏–Ω–¥–µ–∫—Å) –∏ –≤—ã–≤–æ–¥ –∏—Ç–æ–≥–∞: added/updated/deleted/unchanged.

–û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ë–ó —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏. –û—Ç–º–µ—á–µ–Ω–Ω—ã–µ ‚Äî –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ç–µ–∫—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞.

–ü–∞—Ä–æ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞.

–ù–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –≤–∫–ª/–≤—ã–∫–ª –ë–ó:

–ï—Å–ª–∏ –Ω–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚Äî –ë–ó –¥–µ-—Ñ–∞–∫—Ç–æ ¬´–≤—ã–∫–ª—é—á–µ–Ω–∞¬ª.

–ï—Å–ª–∏ –µ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ ‚Äî ¬´–≤–∫–ª—é—á–µ–Ω–∞¬ª –¥–ª—è –¥–∏–∞–ª–æ–≥–∞.

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–Ω–∏–º–∞—Ç—å/–¥–æ–±–∞–≤–ª—è—Ç—å —á–µ–∫–±–æ–∫—Å—ã; –∞–¥–º–∏–Ω ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ—Å—Ç–∞–≤–æ–º –ë–ó.

3.8. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (/stats)
–ü–æ–∫–∞–∑–∞—Ç—å:

–∏–º—è –¥–∏–∞–ª–æ–≥–∞, –º–æ–¥–µ–ª—å, —Å—Ç–∏–ª—å;

–ë–ó: –¥–æ—Å—Ç—É–ø–Ω–∞/–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞;

—Å–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤;

(–æ–ø—Ü.) —Å—á–µ—Ç—á–∏–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ –∑–∞ –¥–∏–∞–ª–æ–≥/—Å–µ—Å—Å–∏—é.

4. RAG ‚Äî –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã
–ï—Å–ª–∏ –≤ –¥–∏–∞–ª–æ–≥–µ –µ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:

–î–µ–ª–∞–µ—Ç—Å—è —Ä–µ—Ç—Ä–∏–≤ (pgvector/—Ñ–∞–π–ª–æ–≤—ã–π/TF-IDF) –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;

–§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç (k –ª—É—á—à–∏—Ö —á–∞–Ω–∫–æ–≤), –∫–∞–∂–¥—ã–π —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ (–Ω–∞–∑–≤–∞–Ω–∏–µ/–ø—É—Ç—å, —Å—Ç—Ä–∞–Ω–∏—Ü–∞);

–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç: ¬´–û—Ç–≤–µ—á–∞–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤. –ï—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚Äî —è–≤–Ω–æ —Å–∫–∞–∂–∏ –∏ –¥–æ–ø–æ–ª–Ω–∏ –æ–±—â–∏–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏. –ù–µ –≤—ã–¥—É–º—ã–≤–∞–π¬ª.

–ï—Å–ª–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —á–∞–Ω–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã ‚Äî –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç ¬´–ø–æ –º–æ–¥–µ–ª–∏¬ª, –æ—Ç–º–µ—á–∞—è, —á—Ç–æ ¬´–≤ –ë–ó —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ¬ª.

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ë–ó ‚Äî –≤—ã—Å–æ–∫–∏–π: –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ—Ç–≤–µ—Ç—ã –æ–ø–∏—Ä–∞—é—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ –Ω–∞ –ë–ó.

5. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –º–æ–¥—É–ª–∏
5.1. –°–ª–æ–∏
Telegram —Å–ª–æ–π ‚Äî bot/telegram_bot.py
–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥, inline-–∫–Ω–æ–ø–æ–∫, —Ç–µ–∫—Å—Ç/–≥–æ–ª–æ—Å/—Ñ–∞–π–ª—ã/—Ñ–æ—Ç–æ, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–µ–Ω—é –≤ post_init.

OpenAI —Å–ª–æ–π ‚Äî bot/openai_helper.py
–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±–≤—è–∑–∫–∞ OpenAI API (—á–∞—Ç/–≤–µ–±/–∞—É–¥–∏–æ/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/–æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π/—Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π).

–ë–ó —Å–ª–æ–π ‚Äî bot/knowledge_base/

indexer.py ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –Ø.–î–∏—Å–∫–æ–º, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞, —á–∞–Ω–∫–∏–Ω–≥, —ç–º–±–µ–¥–¥–∏–Ω–≥–∏, –∞–ø—Å–µ—Ä—Ç –≤ –∏–Ω–¥–µ–∫—Å/–ë–î; —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤;

retriever.py ‚Äî –ø–æ–∏—Å–∫ (pgvector ‚Üí —Ñ–æ–ª–±—ç–∫);

context_manager.py ‚Äî —Å–±–æ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –±–ª–æ–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è LLM.

5.2. –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –º–æ–¥—É–ª–µ–π
5.2.1. OpenAIHelper
python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
class OpenAIHelper:
    def __init__(self, api_key: str): ...

    def list_models_for_menu(self) -> list[str]:
        """–í–µ—Ä–Ω—É—Ç—å –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —á–∞—Ç-–º–æ–¥–µ–ª–µ–π (–≤–∫–ª. o1/o3, –µ—Å–ª–∏ –≤–∏–¥–Ω—ã),
        –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ blacklist/whitelist –∏–∑ settings, —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º."""

    def chat(
        self,
        user_text: str,
        model: str | None,
        temperature: float,
        mode: str,                     # "Pro" | "Expert" | "User" | "CEO"
        kb_context: str | None         # –≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ (–º–æ–∂–µ—Ç –±—ã—Ç—å None)
    ) -> str: ...

    def transcribe_audio(self, bytes_data: bytes) -> str: ...

    def generate_image(self, prompt: str, model: str | None) -> tuple[bytes, str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (image_bytes, used_prompt). –ú–æ–¥–µ–ª—å –±–µ—Ä—ë—Ç—Å—è –∏–∑ IMAGE_MODEL; –ø—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî —Ñ–æ–ª–±—ç–∫."""

    def describe_file(self, bytes_data: bytes, filename: str) -> str: ...
    def describe_image(self, image_bytes: bytes) -> str: ...

    def web_answer(self, query: str) -> tuple[str, list[str]]:
        """–û—Ç–≤–µ—Ç –∏ —Å–ø–∏—Å–æ–∫ URL-–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤. HTTPX —Å follow_redirects=True."""
5.2.2. KB Indexer
python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
@dataclass
class KBMeta:
    id: str
    title: str
    path: str
    encrypted: bool
    updated_at: datetime | None
    pages: int | None

class KnowledgeBaseIndexer:
    def __init__(self, settings): ...

    def sync(self) -> tuple[int, int, int, int]:
        """(added, updated, deleted, unchanged)"""

    def list_documents(self) -> list[KBMeta]:
        """–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –ë–ó."""
5.2.3. KB Retriever
python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
@dataclass
class KBChunk:
    doc_id: str
    doc_title: str
    score: float
    page: int | None
    text: str
    source_ref: str  # –Ω–∞–ø—Ä–∏–º–µ—Ä, "{title} (—Å—Ç—Ä. {page})" –∏–ª–∏ "{path}#{page}"

class KnowledgeBaseRetriever:
    def __init__(self, settings): ...

    def is_vector_store(self) -> bool: ...

    def retrieve(self, query: str, selected_ids: list[str], *, k: int = 6) -> list[KBChunk]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —á–∞–Ω–∫–∏."""
5.2.4. KB ContextManager
python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
class ContextManager:
    def __init__(self, settings): ...

    def build_context(self, chunks: list[KBChunk]) -> str:
        """–°–±–æ—Ä–∫–∞ human-readable –±–ª–æ–∫–∞ + –º–∞—à–∏–Ω–Ω—ã–µ –º–µ—Ç–∫–∏; –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —Ç–æ–∫–µ–Ω–∞–º."""
5.2.5. Telegram Bot ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞ (in-memory)
python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
@dataclass
class DialogState:
    dialog_id: int
    title: str = "–î–∏–∞–ª–æ–≥"
    created_at_ts: float = 0.0
    updated_at_ts: float = 0.0
    model: str | None = None   # –≤—ã–±—Ä–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
    style: str = "Pro"
    kb_selected_ids: list[str] = field(default_factory=list)  # –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –µ—Å–ª–∏/–∫–æ–≥–¥–∞ –ø–æ–¥–∫–ª—é—á–∏–º –ë–î –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤ ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (ORM-–º–æ–¥–µ–ª—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è).

6. –ö–æ–º–∞–Ω–¥—ã –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
–°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã—Å—Ç–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ post_init –≤–æ –≤—Å–µ—Ö scope: default, private, chat_admins):

/start ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –ø–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º;

/help ‚Äî –∫—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞;

/reset ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ (–æ—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç);

/stats ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞;

/kb ‚Äî –º–µ–Ω—é –ë–ó: (–∞–¥–º–∏–Ω) –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è + —Å–ø–∏—Å–æ–∫ –¥–æ–∫–æ–≤ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏; (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å) —Å–ø–∏—Å–æ–∫ –¥–æ–∫–æ–≤;

/model ‚Äî –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ (–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫, —Å üîí –¥–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö);

/mode ‚Äî —Å—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–∞ (Pro/Expert/User/CEO);

/dialogs ‚Äî —Å–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ (–û—Ç–∫—Ä—ã—Ç—å/üóë/‚ûï –ù–æ–≤—ã–π);

/img ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π;

/web ‚Äî –≤–µ–±-–ø–æ–∏—Å–∫ —Å–æ —Å–ø–∏—Å–∫–æ–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.

–°–æ–æ–±—â–µ–Ω–∏—è:

–¢–µ–∫—Å—Ç: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ OpenAIHelper.chat (+kb_context –ø—Ä–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥–æ–∫–∞—Ö).

–ì–æ–ª–æ—Å: —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è ‚Üí –≤—ã–≤–æ–¥ ¬´üéôÔ∏è –í—ã —Å–∫–∞–∑–∞–ª–∏: ‚Ä¶¬ª ‚Üí chat() c —Ç–µ–º –∂–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.

–§–∞–π–ª—ã/—Ñ–æ—Ç–æ: —Ç–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏–∑ (–æ–ø–∏—Å–∞–Ω–∏–µ), –±–µ–∑ –∞–≤—Ç–æ-–∑–∞–≥—Ä—É–∑–∫–∏ –≤ –ë–ó. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –ë–ó ‚Äî —á–µ—Ä–µ–∑ /kb (–¥–ª—è –∞–¥–º–∏–Ω–∞ ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞/–ø–æ—Ç–æ–∫ —Å–∏–Ω—Ö—Ä—ã).

7. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ pgvector
7.1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
URL KB_VECTOR_DB_URL –º–æ–∂–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∫–∞–∫ postgres://....
–ù—É–∂–Ω–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ postgresql+psycopg2://... –¥–ª—è SQLAlchemy.

7.2. DDL (–µ—Å–ª–∏ pgvector –¥–æ—Å—Ç—É–ø–µ–Ω)
sql
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
CREATE EXTENSION IF NOT EXISTS vector;

CREATE TABLE IF NOT EXISTS kb_documents (
  id TEXT PRIMARY KEY,
  title TEXT,
  path TEXT,
  encrypted BOOLEAN DEFAULT FALSE,
  updated_at TIMESTAMPTZ,
  content_hash TEXT
);

CREATE TABLE IF NOT EXISTS kb_chunks (
  id TEXT PRIMARY KEY,
  doc_id TEXT REFERENCES kb_documents(id) ON DELETE CASCADE,
  page INTEGER,
  text TEXT,
  embedding VECTOR(1536), -- –ø–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ–º—É—é —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å
  score FLOAT DEFAULT 0
);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞:
-- CREATE INDEX IF NOT EXISTS idx_kb_chunks_embedding
--   ON kb_chunks USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);
7.3. –ü–æ–≤–µ–¥–µ–Ω–∏–µ
–ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î / –Ω–µ—Ç vector ‚Äî WARN –∏ —Ñ–æ–ª–±—ç–∫ –Ω–∞ —Ñ–∞–π–ª–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å (FAISS/Annoy) –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ–π TF-IDF/BM25.

–í /stats —É–∫–∞–∑—ã–≤–∞—Ç—å ¬´–≤–µ–∫—Ç–æ—Ä: –¥–∞/–Ω–µ—Ç¬ª.

8. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Environment)
–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:

TELEGRAM_BOT_TOKEN

OPENAI_API_KEY

–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:

OPENAI_MODEL ‚Äî –¥–µ—Ñ–æ–ª—Ç–Ω–∞—è —á–∞—Ç-–º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä., gpt-4o)

OPENAI_TEMPERATURE ‚Äî –¥–µ—Ñ–æ–ª—Ç (–Ω–∞–ø—Ä., 0.2)

IMAGE_MODEL ‚Äî gpt-image-1/dall-e-3

ENABLE_IMAGE_GENERATION ‚Äî "true"/"false"

–î–æ—Å—Ç—É–ø—ã:

ADMIN_USER_IDS –∏–ª–∏ ADMIN_SET ‚Äî JSON-–º–∞—Å—Å–∏–≤ ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, [12345678])

ALLOWED_USER_IDS –∏–ª–∏ ALLOWED_SET ‚Äî JSON-–º–∞—Å—Å–∏–≤ ID; –µ—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –≤—Å–µ–º

–ë–ó:

YANDEX_DISK_TOKEN

YANDEX_DISK_FOLDER ‚Äî –∫–æ—Ä–µ–Ω—å –ë–ó, –Ω–∞–ø—Ä. –ë–∞–∑–∞ –ó–Ω–∞–Ω–∏–π

KB_EMBEDDING_MODEL ‚Äî –Ω–∞–ø—Ä. text-embedding-3-small

KB_MAX_CHUNK_TOKENS ‚Äî –Ω–∞–ø—Ä. 600

KB_TOP_K ‚Äî –Ω–∞–ø—Ä. 6

KB_VECTOR_DB_URL ‚Äî URL PostgreSQL (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å)

ALLOWED_MODELS_WHITELIST ‚Äî JSON-–º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ –º–µ–Ω—é –º–æ–¥–µ–ª–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

MODELS_BLACKLIST ‚Äî JSON-–º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

9. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
Conflict getUpdates: –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å polling –∏–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ webhook.

302 –≤ –≤–µ–±-–ø–æ–∏—Å–∫–µ: HTTPX –∫–ª–∏–µ–Ω—Ç —Å follow_redirects=True.

403 –¥–ª—è gpt-image-1: –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å WARN –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ–ª–±—ç–∫ dall-e-3.

KB –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞: –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ¬´–ú–æ–¥—É–ª—å –ë–ó –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω¬ª –∏ –ø–∏—Å–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –≤ –ª–æ–≥–∏ (–±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤).

–ü–∞—Ä–æ–ª–∏: –Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å; —Ö—Ä–∞–Ω–∏—Ç—å ephemeral-–∫–µ—à —Å TTL.

–õ–æ–≥–∏:

INFO ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏;

WARNING ‚Äî —Ñ–æ–ª–±—ç–∫–∏/–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è;

ERROR ‚Äî –∏—Å–∫–ª—é—á–µ–Ω–∏—è/—Å—Ç—ç–∫—Ç—Ä–µ–π—Å—ã.

10. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
–ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã/–ø–∞—Ä–æ–ª–∏/–ø—Ä–æ–º–ø—Ç—ã —Ü–µ–ª–∏–∫–æ–º (—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏ –º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å).

–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤; –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø—ã.

–î–ª—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚Äî –ø–∞—Ä–æ–ª—å —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏ —Å TTL (–∏–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ö—ç—à–∏—Ä–æ–≤–∞—Ç—å).

–ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∞–¥–º–∏–Ω-–æ–ø–µ—Ä–∞—Ü–∏–∏.

11. –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å: —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —á–∞—Å—Ç–∏—á–Ω–æ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ OpenAI/–≤–µ–±-–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤/–Ø.–î–∏—Å–∫–∞ (—Ä–µ—Ç—Ä–∞–∏/—Ç–∞–π–º–∞—É—Ç—ã).

–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: RAG –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤ –º–æ–¥–µ–ª–∏; —á–∞–Ω–∫–∏ k –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏.

–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å: –≤ –±—É–¥—É—â–µ–º –ø–µ—Ä–µ–≤–æ–¥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –≤ –ë–î (ORM).

12. –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–º–∏–Ω–∏–º—É–º)
lua
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
bot/
  main.py
  config.py
  settings.py
  telegram_bot.py
  openai_helper.py
  knowledge_base/
    __init__.py
    indexer.py
    retriever.py
    context_manager.py
README.md
TECH_SPEC.md  <-- —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç
requirements.txt
13. –ü—Ä–∏—ë–º–æ-—Å–¥–∞—Ç–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã (—á–µ–∫-–ª–∏—Å—Ç)
/start ‚Äî –∫–æ–º–∞–Ω–¥—ã –≤ –º–µ–Ω—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–∞–∑–¥–µ–ª—É 6.

/model ‚Äî –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ (–≤–∫–ª. o1/o3 –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –¥–æ—Å—Ç—É–ø–∞), —Ç–µ–∫—É—â–∞—è –º–æ–¥–µ–ª—å —Å ‚úÖ, –≤—ã–±–æ—Ä –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –¥—Ä—É–≥–∏–µ –¥–∏–∞–ª–æ–≥–∏.

/mode ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç—Å—è –≤ /stats; —Ç–æ–Ω –æ—Ç–≤–µ—Ç–∞ –º–µ–Ω—è–µ—Ç—Å—è.

/img ‚Äî –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è; –µ—Å–ª–∏ –ø–µ—Ä–≤–∏—á–Ω–∞—è –º–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–æ–ª–±—ç–∫; –ø–æ–¥–ø–∏—Å—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π prompt.

–ì–æ–ª–æ—Å ‚Äî –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç + —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç.

/web ‚Äî –≤–Ω–∏–∑—É –µ—Å—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (URL), —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã –Ω–µ –ª–æ–º–∞—é—Ç –æ—Ç–≤–µ—Ç.

/kb (–∞–¥–º–∏–Ω) ‚Äî –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è + –æ—Ç—á—ë—Ç; —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏.

/kb (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å) ‚Äî —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏; –≤—ã–±–æ—Ä/—Å–Ω—è—Ç–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç; –ø–∞—Ä–æ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞.

RAG ‚Äî –ø—Ä–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –æ—Ç–≤–µ—Ç –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –ë–ó (–≤–∏–¥–Ω—ã —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤); –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Äî —á–µ—Å—Ç–Ω–æ —Å–æ–æ–±—â–∞–µ–º.

/dialogs ‚Äî —Å–ø–∏—Å–æ–∫, ¬´–û—Ç–∫—Ä—ã—Ç—å¬ª, ¬´üóë¬ª, ¬´‚ûï –ù–æ–≤—ã–π¬ª ‚Äî –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç.

14. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¢–ó: MAJOR.MINOR.PATCH.

–õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –∫–æ–º–∞–Ω–¥, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π ‚Äî —Å–Ω–∞—á–∞–ª–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –ø—Ä–æ–¥—É–∫—Ç–∞.

–ü–æ—Å–ª–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è:

—É–≤–µ–ª–∏—á–∏—Ç—å –≤–µ—Ä—Å–∏—é –≤ —à–∞–ø–∫–µ;

–æ–ø–∏—Å–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ (–¥–∞—Ç–∞, –∞–≤—Ç–æ—Ä, —Å—É—Ç—å, —Ç—Ä–µ–±—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏).

–ñ—É—Ä–Ω–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π:

1.0.0 (2025-07-31): –Ω–∞—á–∞–ª—å–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –¢–ó, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–∞—è —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º.

15. –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ –∏–Ω–≤–∞–∑–∏–≤–Ω–æ)
–ü—Ä–∏–≤–µ—Å—Ç–∏ openai_helper.py –∫ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É –∏–∑ ¬ß5.2.1 (–≤–∫–ª—é—á–∞—è list_models_for_menu, web_answer, generate_image —Å b64 –∏ —Ñ–æ–ª–±—ç–∫–æ–º).

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å knowledge_base/indexer.py|retriever.py|context_manager.py —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏ –∏–∑ ¬ß5.2.2‚Äì5.2.4; –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å kb_available –∏ —Ä–µ–∂–∏–º (pgvector/—Ñ–æ–ª–±—ç–∫).

–û–±–Ω–æ–≤–∏—Ç—å telegram_bot.py: –∫–æ–º–∞–Ω–¥—ã –ø–æ ¬ß6, post_init –¥–ª—è –º–µ–Ω—é, –ª–æ–≥–∏–∫–∞ /kb –ø–æ ¬ß3.7, RAG –ø—Ä–∏ –æ—Ç–≤–µ—Ç–∞—Ö.

–í settings.py ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è postgres:// ‚Üí postgresql+psycopg2://.

–í README.md ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é, –Ω–∞—Å—Ç—Ä–æ–π–∫–µ pgvector, –ø—Ä–∞–≤–∞–º, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏—è, —Ç–∏–ø–æ–≤—ã–º –æ—à–∏–±–∫–∞–º.

–ü—Ä–æ–≥–Ω–∞—Ç—å —á–µ–∫-–ª–∏—Å—Ç –∏–∑ ¬ß13.

16. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –¥–æ–ø—É—â–µ–Ω–∏—è
–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–µ–π o1/o3 –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞/–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤ OpenAI; –µ—Å–ª–∏ API –∏—Ö –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ‚Äî –≤ –º–µ–Ω—é –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º.

–Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫: –≤–æ–∑–º–æ–∂–Ω—ã rate-limit –∏ –∑–∞–¥–µ—Ä–∂–∫–∏ –≤—ã–¥–∞—á–∏ download-—Å—Å—ã–ª–æ–∫; —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è ‚Äî –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è.

–î–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: —Ä–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ª–∏–±–æ b64_json, –ª–∏–±–æ URL ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –æ–±–µ —Å—Ö–µ–º—ã.

–î–ª—è pgvector: –µ—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–µ–ª—å–∑—è –≤–∫–ª—é—á–∏—Ç—å ‚Äî –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–ª–±—ç–∫-—Ä–µ–∂–∏–º–µ, –Ω–æ RAG –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω–µ–µ —Ç–æ—á–Ω—ã–º.

17. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–º–ø–ª–∞–µ–Ω—Å
–ù–µ —Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –≤–Ω–µ –∏–Ω–¥–µ–∫—Å–∞ (–∫—Ä–æ–º–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏).

–£–¥–∞–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

–ú–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ª–æ–≥–∞—Ö.

–°–æ–±–ª—é–¥–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ª–∏—Ü–µ–Ω–∑–∏–π –∏ TOS —Å–µ—Ä–≤–∏—Å–æ–≤ (OpenAI, –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫, Telegram).
