# Telegram Bot ‚Äî OpenAI + RAG (PostgreSQL + PGVector) + Yandex.Disk

–ì–æ—Ç–æ–≤–∞—è —Å–±–æ—Ä–∫–∞ –¥–ª—è Railway. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
- –ß–∞—Ç —Å OpenAI (Chat Completions)
- RAG –Ω–∞ PostgreSQL + PGVector
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ë–∞–∑—ã –∑–Ω–∞–Ω–∏–π —Å –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–æ–º
- –ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å: –≥–æ–ª–æ—Å (Whisper), –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (DALL¬∑E)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º (–∞–¥–º–∏–Ω—ã/—Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ)
- –ö–æ–º–∞–Ω–¥—ã: /start, /help, /reset, /stats, /dialogs, /dialog, /kb, /kb_diag, /model, /mode, /img, /web, /grant, /revoke, /whoami

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–ª–æ–∫–∞–ª—å–Ω–æ)
1. –°–æ–∑–¥–∞–π—Ç–µ –ë–î PostgreSQL –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ:
   ```sql
   CREATE EXTENSION IF NOT EXISTS vector;
   ```
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è.
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   pip install -r requirements.txt
   ```
4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å—Ö–µ–º—É –ë–î (alembic):
   ```bash
   alembic upgrade head
   ```
5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:
   ```bash
   python -m bot.main
   ```

## Railway
- –£–∫–∞–∂–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ `.env.example`
- –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞: `python -m bot.main`

## –õ–∏—Ü–µ–Ω–∑–∏—è
MIT

## –ö–æ–º–∞–Ω–¥—ã –∏ –æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

- `/start` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–µ—Ä–≤–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞.
- `/help` ‚Äî –∫—Ä–∞—Ç–∫–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏.
- `/dialogs` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö –¥–∏–∞–ª–æ–≥–æ–≤ (–∫–Ω–æ–ø–∫–∏ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è/–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è/—ç–∫—Å–ø–æ—Ä—Ç–∞/—É–¥–∞–ª–µ–Ω–∏—è).
- `/dialog <id>` ‚Äî —Å–¥–µ–ª–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥ –∞–∫—Ç–∏–≤–Ω—ã–º.
- `/dialog_new` ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥.
- `/kb` ‚Äî –º–µ–Ω—é –ë–∞–∑—ã –∑–Ω–∞–Ω–∏–π: —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞ (–ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ), –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ/—Å–Ω—è—Ç–∏–µ –∫ –∞–∫—Ç–∏–≤–Ω–æ–º—É –¥–∏–∞–ª–æ–≥—É.
- `/kb_sync` ‚Äî –∞–¥–º–∏–Ω: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–ó —Å –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–æ–º (—Å–∫–∞—á–∞—Ç—å/–ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ/–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã).
- `/kb_pdf_diag` ‚Äî –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–∞–∑–±–æ—Ä—â–∏–∫–∞ PDF.
- `/model <name>` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å OpenAI –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `gpt-4o-mini`, `gpt-4-turbo`).
- `/mode <ceo|expert|pro|user>` ‚Äî –≤—ã–±—Ä–∞—Ç—å —Å—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–æ–≤ (–≤–ª–∏—è–µ—Ç –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é).
- `/stats` ‚Äî –ø—Ä–æ—Å—Ç–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∏–∞–ª–æ–≥–æ–≤/—Å–æ–æ–±—â–µ–Ω–∏–π.
- `/reset` ‚Äî –æ—á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è). –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è.
- `/img <prompt>` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–≤ —Å–±–æ—Ä–∫–µ –≤–∫–ª—é—á–µ–Ω–∞ –∑–∞–≥–æ—Ç–æ–≤–∫–∞ –≤ `openai_helper.py`; –ø–æ–¥–∫–ª—é—á–∏—Ç–µ —Ö–µ–Ω–¥–ª–µ—Ä –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).
- `/web <query>` ‚Äî –ø–æ–∏—Å–∫ –ø–æ –≤–µ–±—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ; —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞ –∫ –ø–æ–∏—Å–∫—É, –ø—Ä–∏–º–µ—Ä –≤ –¢–ó).
- `/whoami` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –≤–∞—à —Å—Ç–∞—Ç—É—Å: —Ä–æ–ª—å (admin/allowed/guest) –∏ —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
- `/grant <tg_id>` ‚Äî –∞–¥–º–∏–Ω: –≤—ã–¥–∞—Ç—å –¥–æ—Å—Ç—É–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–¥–æ–±–∞–≤–∏—Ç—å/–ø–æ–º–µ—Ç–∏—Ç—å `is_allowed=TRUE`).
- `/revoke <tg_id>` ‚Äî –∞–¥–º–∏–Ω: –æ—Ç–æ–∑–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø (`is_allowed=FALSE`).

### –ü–æ–≤–µ–¥–µ–Ω–∏–µ RAG
- –ü—Ä–∏ –≤–æ–ø—Ä–æ—Å–µ –±–æ—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–æ `KB_TOP_K` —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –∏–∑ –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã—Ö –∫ –∞–∫—Ç–∏–≤–Ω–æ–º—É –¥–∏–∞–ª–æ–≥—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∏—Ö –≤ prompt.
- –ï—Å–ª–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –Ω–µ—Ç ‚Äî –±–æ—Ç —á–µ—Å—Ç–Ω–æ —Å–æ–æ–±—â–∞–µ—Ç –æ–± —ç—Ç–æ–º –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –±–µ–∑ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π.
- –í –∫–æ–Ω—Ü–µ –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –∫—Ä–∞—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (–∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤).

### PDF —Å –ø–∞—Ä–æ–ª–µ–º
- –ó–∞—â–∏—â—ë–Ω–Ω—ã–µ PDF –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ `/kb` —Å —Å–∏–º–≤–æ–ª–æ–º üîí. –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –±–æ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≤–∫–ª—é—á–µ–Ω–∞ —á–∞—Å—Ç–∏—á–Ω–æ: –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ –ø–∞—Ä–æ–ª—é –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –¥–µ–π—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–∫—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞).

–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Äî —Å–º. **TECH_SPEC.md**.
