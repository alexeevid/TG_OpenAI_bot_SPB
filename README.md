
# Telegram OpenAI RAG Bot (Yandex Disk, no pgvector)

–ì–æ—Ç–æ–≤—ã–π –±–æ—Ç —Å:
- RAG –ø–æ–≤–µ—Ä—Ö –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞ (WebDAV): `/kb_sync`, `/kb`, `/kb_search`
- –í—ã–±–æ—Ä–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç (inline –∫–Ω–æ–ø–∫–∏)
- –ö–æ—Å–∏–Ω—É—Å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º –±–µ–∑ pgvector (—Ö—Ä–∞–Ω–∏–º –≤ ARRAY(Float))
- –ì–æ–ª–æ—Å ‚Üí —Ç–µ–∫—Å—Ç ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (`/image`) —Å `dall-e-3`
- –í–∞–π—Ç–ª–∏—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`ALLOWED_USER_IDS`), –∞–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã (`ADMIN_USER_IDS`)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –ó–∞–ª–µ–π —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –≤ GitHub / Railway.
2. –ü—Ä–æ—Å—Ç–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–º. `.env.example`):
   - `DB_URL` –≤–∏–¥–∞ `postgresql+psycopg://...`
   - `YANDEX_DISK_TOKEN`, `YANDEX_ROOT_PATH`
   - `OPENAI_API_KEY`, `TELEGRAM_BOT_TOKEN`
3. –ó–∞–¥–µ–ø–ª–æ–π (Dockerfile —É–∂–µ –µ—Å—Ç—å).

–í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
Tables created via Base.metadata.create_all()
Application started
```

## –ö–æ–º–∞–Ω–¥—ã

- `/help` ‚Äî –ø–æ–º–æ—â—å
- `/reset` ‚Äî —Å–±—Ä–æ—Å –¥–∏–∞–ª–æ–≥–∞
- `/kb` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –ë–ó (–∏–∑ –ë–î) + –≤—ã–±—Ä–∞—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- `/kb_reset` ‚Äî —Å–±—Ä–æ—Å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `/kb_search <–≤–æ–ø—Ä–æ—Å>` ‚Äî –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å —Å —É—á—ë—Ç–æ–º –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `/kb_sync` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ë–ó —Å –Ø.–î–∏—Å–∫–∞ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º)
- `/pdfpass <filename.pdf> <password>` ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –¥–ª—è PDF –ø–µ—Ä–µ–¥ `/kb_sync`
- `/image <prompt>` ‚Äî —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. `/kb_sync` –≤—ã—Ç—è–≥–∏–≤–∞–µ—Ç –≤—Å—ë —Å –Ø.–î–∏—Å–∫–∞ (WebDAV), –ø–∞—Ä—Å–∏—Ç, —Ä–µ–∂–µ—Ç –Ω–∞ —á–∞–Ω–∫–∏, —ç–º–±–µ–¥–¥–∏—Ç, —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç –≤ Postgres.
2. `/kb` ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–∏–∑ Postgres), –ø–æ–∑–≤–æ–ª—è—è –≤—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—ã–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç.
3. `/kb_search` ‚Äî —ç–º–±–µ–¥–¥–∏—Ç –∑–∞–ø—Ä–æ—Å, –∏—â–µ—Ç –±–ª–∏–∂–∞–π—à–∏–µ —á–∞–Ω–∫–∏ –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö + –≤–æ–ø—Ä–æ—Å –≤ LLM.
4. `/reset` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (—á–µ—Ä–µ–∑ `/kb_reset` ‚Äî —Ç–æ–ª—å–∫–æ –≤—ã–±–æ—Ä –ë–ó).

## –í–∞–∂–Ω–æ

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `httpx==0.26.0`, —á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å `python-telegram-bot==20.8`.
- Pydantic v2 + `pydantic-settings`.
- –ë–µ–∑ Alembic –∏ pgvector ‚Äî –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ `Base.metadata.create_all` –∏ ARRAY(Float).

–£–¥–∞—á–∏! üöÄ
