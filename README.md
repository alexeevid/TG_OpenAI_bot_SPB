## –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (KB) ‚Äî —Ä–µ–∂–∏–º RAG

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ö–æ–º–∞–Ω–¥–∞ `/kb` –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç **—Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**. –í—ã–±–æ—Ä —á–µ–∫–±–æ–∫—Å–∞–º–∏ (`‚òê/‚òë`) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –±—É–¥—É—Ç –ª–∏ –∑–Ω–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –≤ –æ—Ç–≤–µ—Ç—ã.
- **–ù–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è ¬´–≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å¬ª** ‚Äî –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ = RAG –≤—ã–∫–ª—é—á–µ–Ω; –≤—ã–±—Ä–∞–Ω ‚â•1 –¥–æ–∫—É–º–µ–Ω—Ç = RAG –≤–∫–ª—é—á–µ–Ω.
- –ü—Ä–∏ –æ—Ç–≤–µ—Ç–∞—Ö (–∏ –Ω–∞ —Ç–µ–∫—Å—Ç, –∏ –Ω–∞ –≥–æ–ª–æ—Å) –±–æ—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –ø–æ–¥–º–µ—à–∏–≤–∞–µ—Ç –∏—Ö –∫ –ø—Ä–æ–º–ø—Ç—É.

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤)
- –£ –∞–¥–º–∏–Ω–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ `/kb` **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** —Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º (–Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫ –∏ —Ç.–ø.).
- –ü–æ—Å–ª–µ —Å–∏–Ω–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—Ç—á–µ—Ç: ¬´–î–æ–±–∞–≤–ª–µ–Ω–æ/–û–±–Ω–æ–≤–ª–µ–Ω–æ/–£–¥–∞–ª–µ–Ω–æ/–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π¬ª.
- –ù–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—é—Ç—Å—è –∑–Ω–∞—á–∫–æ–º `üÜï`.

> –ß—Ç–æ–±—ã –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤—å—Ç–µ ¬´–∫—É–ª–¥–∞—É–Ω¬ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ –∫–æ–¥–µ –∏–Ω–¥–µ–∫—Å–∞—Ç–æ—Ä–∞.

### –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- –¢–∞–∫–∏–µ —Ñ–∞–π–ª—ã –æ—Ç–º–µ—á–µ–Ω—ã –∑–Ω–∞—á–∫–æ–º `üîê`.
- –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –±–æ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å. –î–∞—ë—Ç—Å—è 3 –ø–æ–ø—ã—Ç–∫–∏. –ü–∞—Ä–æ–ª—å **–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è**.
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç.

### –ù–∞–≤–∏–≥–∞—Ü–∏—è
- –°–ø–∏—Å–æ–∫ –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π (–ø–æ 10 —à—Ç—É–∫). –ï—Å—Ç—å –∫–Ω–æ–ø–∫–∏ `‚¨ÖÔ∏è/‚û°Ô∏è`, ¬´üßπ –û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä¬ª –∏ ¬´üìÑ –í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ¬ª.
- –í `/stats` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∏ –∫–æ—Ä–æ—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∏–Ω–¥–µ–∫—Å–∞—Ç–æ—Ä—É/—Ä–µ—Ç—Ä–∏–≤–µ—Ä—É
–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä `KBService` (`bot/knowledge_base/service.py`), –∫–æ—Ç–æ—Ä—ã–π –æ–∂–∏–¥–∞–µ—Ç:

- `indexer.sync()` ‚Üí –ª–∏–±–æ `(added, updated, deleted, unchanged)`, –ª–∏–±–æ `(added, updated, deleted, unchanged, added_ids)`
- `indexer.list_docs(query, page, page_size) -> (docs, total_pages)` **–∏–ª–∏** `indexer.list_all() -> list`
- `indexer.get_doc_by_id(doc_id) -> meta` (–¥–ª—è –ø–æ–ª—è `encrypted`) ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
- `indexer.index_encrypted(doc_id, password)` ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ)
- `retriever.retrieve(text, doc_ids, top_k)` **–∏–ª–∏** `retrieve(text, selected_docs)`
- `ContextManager.build_context(chunks)` ‚Äî —Å–æ–±–µ—Ä—ë—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π RAG‚Äë–∫–æ–Ω—Ç–µ–∫—Å—Ç

`KBService` —Å—Ç–∞—Ä–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–æ–∏—Ç—å—Å—è –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã (—á–µ—Ä–µ–∑ `hasattr`/`TypeError`), –ø–æ—ç—Ç–æ–º—É –º–µ–Ω—è—Ç—å –≤–∞—à —Ç–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å–∞—Ç–æ—Ä, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, **–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è**.
